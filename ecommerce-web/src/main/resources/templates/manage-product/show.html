<!DOCTYPE html>
<html lang="en" th:replace="~{fragments/layout :: layout (body=~{::body}, script=~{::script}, title=${'Add product'})}" >

<body>
    <div class="container-lg" th:with="add = ${product.name == null}">
        <h1 class="mb-5" th:text="${(add ? 'Add' : 'Edit') + ' product'}"></h1>

        <form class="border shadow p-4 rounded-2 my-4 row" method="post" th:object="${product}" enctype="multipart/form-data"
              th:action="@{__(${ '/products' + (add ? '/add' : '/update/' + product.id)})__}">

            <div class="col">
                <div class="form-group my-3">
                    <label for="add-product-form-name">Name</label>
                    <input class="form-control mt-1" id="add-product-form-name" type="text" required th:field="*{name}"
                           minlength="5" maxlength="50">
                </div>

                <!--    for now, it will be replaced by a tree    -->
                <div class="form-group my-3">
                    <label for="add-product-form-category">Category</label>
                    <select class="form-control mt-1" id="add-product-form-category" required th:field="*{category}">
                        <option th:selected="${category == product.category}" th:each="category : ${categoryList}" th:value="${category.name}" th:text="${category.name}"></option>
                    </select>
                </div>

                <div class="form-group my-3">
                    <label for="add-product-form-description">Description</label>
                    <textarea class="form-control mt-1" id="add-product-form-description" required
                              th:field="*{description}" minlength="20" maxlength="20000">

                    </textarea>
                </div>

                <div class="form-group my-3">
                    <label for="add-product-form-price">Price</label>
                    <input class="form-control mt-1" id="add-product-form-price" type="text" required th:field="*{price}">
                </div>

                <div class="form-group my-3">
                    <label for="add-product-form-quantity">Quantity</label>
                    <input class="form-control mt-1" id="add-product-form-quantity" type="number" min="1" max="1000000"
                           required th:field="*{quantity}" value="1">
                </div>
            </div>
            <div class="col d-flex flex-column justify-content-around">
                <div class="align-self-center d-flex align-items-center justify-content-center img-thumbnail"
                     id="add-product-form-image-container" style="width: 20rem; height: 20rem">
                    <img th:src="@{__(${product.image != null ? ('/images/products/' +
                             product.image) : '/images/no-img.png' })__}" style="max-width: 19rem; max-height: 19rem" id="add-product-image-preview">
                </div>

                <div class="form-group my-3">
                    <label for="add-product-form-image">Image</label>
                    <input class="form-control mt-1" id="add-product-form-image" type="file"
                           accept="image/png, image/jpeg" th:field="*{image}">
                </div>
            </div>

            <div class="d-flex justify-content-center">
                <button class="btn btn-primary mt-5 mb-3"  type="submit" style="width: 10rem; height: 4rem;"
                        th:text="${(add ? 'Add' : 'Edit') + ' product'}"></button>
            </div>
        </form>
    </div>
</body>

<script>
    let file = $('#add-product-form-image')[0];
    let preview = $('#add-product-image-preview')[0];
    file.onchange = function() {
        preview.setAttribute('src', URL.createObjectURL(this.files[0]));
    };
</script>

</html>